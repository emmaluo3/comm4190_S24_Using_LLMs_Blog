<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-04-04">
<meta name="description" content="Creating April Fools Marketing Campaigns using AI">

<title>My Explorations with LLMs - April Fools!</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">My Explorations with LLMs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">April Fools!</h1>
                  <div>
        <div class="description">
          Creating April Fools Marketing Campaigns using AI
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">LLMs</div>
                <div class="quarto-category">prompting</div>
                <div class="quarto-category">marketing</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 4, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>April Fools Day is known for its silly and outrageous jokes. However, more recently companies have been utilizing the day as an opportunity for eye-catching social media marketing campaigns. This can take place in many forms, from launching a “new product” to using satire within the advertisement. These campaigns often do incredibly well, garnering up to millions of likes and views, as these campaigns are bound to be shared with others. Here are some of my favorite marketing campaigns from this past April Fools:</p>
<p><img src="maybelline.png" style="width:50%;"> <img src="soldejaneiro.png" style="width:50%;"> <img src="spicy9.png" style="width:50%;"></p>
<section id="prompting" class="level2">
<h2 class="anchored" data-anchor-id="prompting">Prompting</h2>
<p>I first gave the example campaigns (pictured above) to Open AI Vision to convert the images to text: ### Sol de Janeiro: The image shows two cosmetic products with the branding “SOL DE JANEIRO”. One is labeled “ARANHA SPIDER SALVE” which suggests it might be a topical skin cream with descriptors like “Hydrate and 'perfumize'”, and the second is a “PERFUME MIST SPIDER PHEROMONE”. Both products feature a spider-themed design, hinting at spider-related properties or ingredients. The context of the setting seems to be a forest or jungle environment with a prominent spider web in the background, emphasizing the spider theme of these products. However, considering the unusual concept of spider-themed scents and creams, please be aware that this could be a fictional or novelty product, and such items might not actually contain spider-derived ingredients. ### Maybelline: This image features an advertisement for a cosmetic product. The product is a self-tanner named “Maybelline New York Dream Matte Mousse Self Tanner,” with a specific note on its chocolate mousse scent and body glow. The shade is “Honey Beige Medium.” It's marketed as being chocolate mousse scented and containing organic raw honey and vitamin C.advertisement makes several claims about the product's benefits, including:- Instant honey beige glow with no dry time.- Each application lasts 90 days.- White sheets proof, meaning it presumably won't stain bed linens.- Water-resistant, sweat-resistant, life-proof.’s important to note that some claims may be exaggerated (like a 90-day lasting period), as real performance can vary based on individual use and application. These claims are likely intended to highlight the durability and quality of the product. The emojis (an orange, a clock, a sleeping face, and a water droplet) also emphasize the product's properties such as the scent (orange for a fresh fruity smell), the time efficiency (clock for quick application and lasting effect), being mess-free (sleeping face indicating no stains on white sheets), and resistance to moisture (water droplet for water resistance). ### Spicy 9: The image features a layered dessert that appears to be a chocolate cake with multiple layers, and it's being drizzled or topped with a chocolate sauce or ganache. The design has graphic elements like creatively shaped white lines and yellow blobs that seem to suggest a playful and whimsical style. There's text overlaid on the image which states “We're Rebranding”, suggesting that a company or brand is undergoing a process to change and update their image or identity. Below the cake, there's a logo or brand name “SWEET 7” which could potentially be the name of the bakery or dessert shop related to the rebranding. The background shows a blurred interior space that looks like it could be a cafe or restaurant, with tables, chairs, and counters</p>
</section>
<section id="generating-campaigns" class="level2">
<h2 class="anchored" data-anchor-id="generating-campaigns">Generating Campaigns</h2>
<p>I then prompted GPT 4 to create April Fools social media marketing campaigns for different companies based on the examples above. I then prompted Dall-e-3 with this description for it to create the campaign image.</p>
<section id="trader-joes" class="level3">
<h3 class="anchored" data-anchor-id="trader-joes">Trader Joes</h3>
<p><em>GPT</em>: Social Media Post Description: Visual: The image features a beautifully styled photo of four elegantly designed bottles, each with a distinct, artistic label that represents the different “air flavors.” The bottles are set against backdrops that reflect their specific scents:</p>
<p>Napa Valley Vineyard Breeze: A lush vineyard background with grapes and greenery. Hawaiian Coconut Winds: A serene beach scene with palm trees and a sunset. Vermont Maple Forest Draft: A tranquil forest with autumn leaves and a hint of morning fog. Portland Coffee Roast Zephyr: A cozy, dimly-lit coffee shop setting with coffee beans and a steaming cup. Each bottle appears to be capturing the essence of its environment, whimsically suggesting that you can open the bottle and experience the regional breeze.</p>
<p>Caption: “🌬️✨ Introducing Trader Joe’s Essential Air Flavors! ✨🌬️ Ever wished you could bottle the refreshing breeze of Napa Valley or the warm winds of Hawaii? Now you can! Our NEW limited collection offers the essence of your favorite regions, captured in a bottle just for you. Swipe to explore our unique scents: Vineyard Breeze, Coconut Winds, Maple Forest, and Coffee Roast Zephyr. Available today only! 😉 #AprilFools #TJEssentials #BreatheInJoy”</p>
<p>Engagement Strategy: Swipe Feature: Encourage users to swipe through multiple images, each focusing on one of the bottles with its corresponding backdrop, providing a closer look at the playful details. Call to Action: Ask followers to comment with the scent they’d love to try or to tag a friend who would believe these could be real. This fosters interaction and increases engagement. Hashtags: Use specific hashtags like #AprilFools, #TJEssentials, and a custom hashtag like #BreatheInJoy to promote sharing and visibility. This post would be playful and visually appealing, capturing the essence of Trader Joe’s brand while engaging the audience with a humorous April Fools’ twist.</p>
<p><img src="traderjoes.png" style="width:50%;"></p>
<p>Surprisingly, the image seems accurate, with even the words being mostly accurate, which I usually haven’t seen with Dall-e-3. However, the overall April Fools concept isn’t clear; the concept seems confusing and I don’t see the direct relation with humor/satire. The campaign also doesn’t directly relate to Trader Joes. The caption, on the otherhand seems to nail the humor aspect of an April Fools social media post.</p>
<p>I suspected that my prompting was too broad so I told GPT to create a campaign for a popular Trader Joe’s product:</p>
<p><em>GPT</em>: For a playful April Fools’ campaign centered on a popular Trader Joe’s product, let’s use their beloved “Everything But The Bagel Sesame Seasoning Blend” as a basis for an imaginative new product twist.</p>
<p>Campaign Name: Trader Joe’s “Everything But The Bagel… Drink?” Concept: Trader Joe’s announces the launch of their latest innovative product, the “Everything But The Bagel Drink”. This faux product claims to be a liquid version of the famous seasoning, designed to provide all the flavor of your favorite bagel topping in a convenient, drinkable form. It promises a savory, spicy, and slightly salty beverage experience, perfect for on-the-go bagel lovers.</p>
<p>Visual: The campaign image features a sleek, modern-looking bottle with clear glass that showcases a slightly cloudy, speckled liquid resembling the seasoning blend suspended in water. The label mimics the original seasoning packaging but adapted for a beverage, complete with quirky descriptions and serving suggestions, such as “Perfect for your morning rush!” or “Just shake and sip your way to flavor town!”</p>
<p>Caption for Social Media Post: “🥯💧 Introducing the latest from Trader Joe’s: Everything But The Bagel Drink! Why sprinkle when you can sip? Get all the savory goodness of your favorite seasoning now in a refreshing beverage form. Limited time only - because who wouldn’t want their seasoning on-the-go? 😄 #TJEBTB #AprilFools #TraderJoes”</p>
<p>Engagement Strategy: Product Image: A high-quality photo of the bottle, staged in a breakfast setting, perhaps next to a plain, unseasoned bagel, emphasizing the drink as an alternative. Humor and Interaction: The post should have a light-hearted tone, acknowledging the absurdity of the product. Ask followers to comment on other Trader Joe’s products they think should have a drinkable version. Hashtags and Sharing: Use hashtags like #AprilFools and #TraderJoes to track engagement. Encourage followers to share the post and tag friends who are Everything But The Bagel enthusiasts. This post leverages the popularity and iconic status of the Everything But The Bagel Seasoning at Trader Joe’s to create a humorous and memorable April Fools’ Day prank, engaging customers with the brand in a fun and creative way.</p>
<p><img src="bagel.png" style="width:50%;"> This campaign was significantly better and I can see this being used for Trader Joes. I then asked GPT to create a campaign for Gong Cha.</p>
</section>
<section id="gong-cha" class="level3">
<h3 class="anchored" data-anchor-id="gong-cha">Gong Cha</h3>
<p>For an engaging April Fools’ campaign centered around Gong Cha, a popular bubble tea chain, let’s play with their famous Milk Tea.</p>
<p>Campaign Name: Gong Cha “Bubble Tea Soup” Concept: Gong Cha announces the debut of their audacious new menu item, “Bubble Tea Soup.” This mock product is a humorous take on transforming their classic milk tea into a savory soup, complete with chewy tapioca pearls, claiming it’s the perfect blend of your favorite drink and a comforting soup.</p>
<p>Visual: The image shows a bowl commonly used for Asian soups, filled with a broth-looking liquid resembling milk tea. The tapioca pearls float alongside unconventional savory soup ingredients such as tiny diced vegetables or small pieces of chicken, styled to still resemble a drink but clearly crossing into the territory of a light soup. The setting could be a cozy café table, enhancing the homely, comforting vibe of a soup.</p>
<p>Caption for Social Media Post: “🍲☕ Introducing the revolutionary Bubble Tea Soup at Gong Cha! Why decide between a drink and a meal when you can have both? Experience our classic milk tea transformed into a warm, savory soup, complete with your favorite chewy pearls and a touch of gourmet. Perfect for those chilly days! Available today only. #GongChaGoesGourmet #AprilFools #BubbleTeaSoup”</p>
<p>Engagement Strategy: Product Image: A creatively styled photo of the bubble tea soup in an elegant, traditional soup bowl, perhaps with a spoon and chopsticks on the side, to blur the lines between beverage and meal. Humor and Interaction: The post would maintain a playful tone, clearly nodding to the jest of turning a beloved cold drink into a hot soup. Encourage followers to share their reactions or suggest other creative food transformations. Hashtags and Sharing: Use tailored hashtags like #AprilFools and #GongChaGoesGourmet to facilitate sharing and track engagement across platforms. Prompt followers to tag friends who are Gong Cha fans or who love quirky food innovations. This mock campaign taps into the popularity of Gong Cha’s bubble tea while adding a humorous twist that engages customers in a lighthearted and memorable way, perfect for social media buzz on April Fools’ Day. <img src="boba.png" style="width:50%;"></p>
<p>Wow… this is probably the weirdest combination of foods I’ve ever seen. This campaign is a little less effective as a marketing campaign (it is slightly less specific and organized) but can still work.</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Overall, GPT 4 seems to be aware of popular products of top brands. Brands can utilize this to effectively generate marketing campaign ideas.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/emmaluo3\.github\.io\/comm4190_S24_Using_LLMs_Blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>